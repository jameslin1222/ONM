Note: AI suggest, Not confirmed!  (alpha 1)


Q:
å·²çŸ¥æœ‰2å°ä¸»æ©Ÿéƒ½å®‰è£äº†Oracle Database 19cï¼ŒOSéƒ½æ˜¯Oracle Linux 8.10 è³‡è¨Šå¦‚ä¸‹: db19c01, 192.168.56.19,port=1521, SID=cdb1, PDB=pdb1, dbuser=system,dbpassword=oracle,osuser=root,ospassword=oracle
db19c02, 192.168.56.20,port=1521, SID=cdb1, PDB=pdb1, dbuser=system,dbpassword=oracle,osuser=root,ospassword=oracle
ç¾åœ¨æƒ³è¦åšActive Data Guardï¼Œdb19c01åšPrimary, db19c02åšstandbyï¼Œ è«‹æä¾›æ³¨æ„äº‹é …å’Œæ“ä½œæ­¥é©Ÿ



ANS:
å¿«é€Ÿå›ç­”ï¼š
åœ¨ Oracle 19c ä¸Šå»ºç«‹ Active Data Guardï¼Œéœ€è¦å…ˆç¢ºä¿å…©å°ä¸»æ©Ÿç’°å¢ƒä¸€è‡´ã€ç¶²è·¯æš¢é€šã€è³‡æ–™åº«ç‰ˆæœ¬ç›¸åŒï¼Œä¸¦å®Œæˆ Primary èˆ‡ Standby çš„åˆå§‹åŒ–ã€‚å»ºè­°ä½¿ç”¨ Data Guard Broker ä¾†ç°¡åŒ–ç®¡ç†ã€‚æ­¥é©ŸåŒ…å«ï¼šç’°å¢ƒæº–å‚™ â†’ Primary è¨­å®š â†’ å‚™åº«å»ºç«‹ â†’ å•Ÿç”¨ Data Guard Broker â†’ é©—è­‰åŒæ­¥èˆ‡é–‹å•Ÿåªè®€æ¨¡å¼ã€‚



âš ï¸ æ³¨æ„äº‹é …
- ç‰ˆæœ¬ä¸€è‡´æ€§ï¼šPrimary èˆ‡ Standby å¿…é ˆç›¸åŒç‰ˆæœ¬ã€ç›¸åŒè£œä¸ã€‚
- OS èˆ‡åƒæ•¸ä¸€è‡´ï¼šOracle Linux 8.10ï¼Œå»ºè­°å…©å°ä¸»æ©Ÿçš„ OS kernelã€æ™‚å€ã€å­—ç¬¦é›†ä¸€è‡´ã€‚
- ç¶²è·¯é€£é€šæ€§ï¼šç¢ºä¿ 1521 port é–‹æ”¾ï¼Œå…©å°ä¸»æ©Ÿèƒ½äº’ç›¸è§£æ hostnameã€‚
- å¯†ç¢¼æª”æ¡ˆï¼šPrimary èˆ‡ Standby çš„ orapwd å¿…é ˆä¸€è‡´ã€‚
- åˆå§‹åŒ–åƒæ•¸ï¼šå¦‚ DB_UNIQUE_NAMEã€LOG_ARCHIVE_CONFIGã€LOG_ARCHIVE_DEST_nã€REMOTE_LOGIN_PASSWORDFILE ç­‰éœ€æ­£ç¢ºé…ç½®ã€‚
- å‚™ä»½ç­–ç•¥ï¼šActive Data Guard æä¾›åªè®€æŸ¥è©¢ï¼Œä½†ä»éœ€å®šæœŸå‚™ä»½ Primaryã€‚

ğŸ›  æ“ä½œæ­¥é©Ÿ
1. ç’°å¢ƒæº–å‚™
- è¨­å®šä¸»æ©Ÿåï¼š
- db19c01 â†’ primary-db
- db19c02 â†’ standby-db
- ç¢ºèªå…©å°ä¸»æ©Ÿèƒ½äº’ pingï¼Œä¸¦é…ç½® /etc/hostsã€‚
- ç¢ºä¿ Oracle è»Ÿé«”å®‰è£ç›®éŒ„ä¸€è‡´ã€‚


2. Primary è³‡æ–™åº«è¨­å®š (db19c01)
- 2.1 ä¿®æ”¹åˆå§‹åŒ–åƒæ•¸ï¼š
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
ALTER SYSTEM SET DB_UNIQUE_NAME='cdb1pri' SCOPE=SPFILE;
ALTER SYSTEM SET LOG_ARCHIVE_CONFIG='DG_CONFIG=(cdb1pri,cdb1std)';
ALTER SYSTEM SET LOG_ARCHIVE_DEST_2='SERVICE=cdb1std ASYNC VALID_FOR=(ONLINE_LOGFILES,PRIMARY_ROLE) DB_UNIQUE_NAME=cdb1std';
ALTER SYSTEM SET REMOTE_LOGIN_PASSWORDFILE=EXCLUSIVE SCOPE=SPFILE;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2.2 å»ºç«‹ standby redo logï¼š
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
ALTER DATABASE ADD STANDBY LOGFILE ('/u01/app/oracle/oradata/cdb1/stdredo01.log') SIZE 200M;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2.3 å»ºç«‹å¯†ç¢¼æª”ä¸¦è¤‡è£½åˆ° Standbyã€‚




3. å»ºç«‹ Standby è³‡æ–™åº« (db19c02)
- 3.1 ä½¿ç”¨ RMAN å¾ Primary è¤‡è£½ï¼š
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
rman target sys@cdb1pri auxiliary sys@cdb1std
RMAN> DUPLICATE TARGET DATABASE FOR STANDBY FROM ACTIVE DATABASE DORECOVER;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
- ç¢ºèª DB_UNIQUE_NAME='cdb1std'ã€‚



4. å•Ÿç”¨ Data Guard Broker
- åœ¨ Primary å•Ÿç”¨ï¼š
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
ALTER SYSTEM SET DG_BROKER_START=TRUE;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- åœ¨ Standby å•Ÿç”¨ï¼š
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
ALTER SYSTEM SET DG_BROKER_START=TRUE;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- ä½¿ç”¨ dgmgrl å»ºç«‹é…ç½®ï¼š
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
DGMGRL> CREATE CONFIGURATION 'adg_config' AS PRIMARY DATABASE IS 'cdb1pri' CONNECT IDENTIFIER IS cdb1pri;
DGMGRL> ADD DATABASE 'cdb1std' AS CONNECT IDENTIFIER IS cdb1std MAINTAINED AS PHYSICAL;
DGMGRL> ENABLE CONFIGURATION;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


5. é©—è­‰èˆ‡å•Ÿç”¨ Active Data Guard
- ç¢ºèªåŒæ­¥ï¼š
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
DGMGRL> SHOW CONFIGURATION;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- å°‡ Standby é–‹å•Ÿåªè®€ï¼š
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
ALTER DATABASE OPEN READ ONLY;
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~


============

âœ… æœ€å¾Œæª¢æŸ¥
- Primary èˆ‡ Standby ç‹€æ…‹å‡ç‚º SUCCESSã€‚
- Standby å¯åŸ·è¡ŒæŸ¥è©¢ï¼Œä¸¦æŒçºŒæ¥æ”¶ redoã€‚
- æ¸¬è©¦æ•…éšœåˆ‡æ›èˆ‡åˆ‡å›ã€‚


ref1: https://docs.oracle.com/en/database/oracle/oracle-database/19/haovw/configure-and-deploy-oracle-data-guard.html

ref2: https://oracle-base.com/articles/19c/data-guard-setup-using-broker-19c




