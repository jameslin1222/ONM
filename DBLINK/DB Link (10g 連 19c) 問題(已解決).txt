DB Link (10g 連 19c) 問題(已解決)

1. 版本不相容問題
ERROR at line 1:
ORA-01031: insufficient privileges

要在19c Server那邊設置 sqlnet.ora
$ cd $ORACLE_HOME/network/admin/
$ vi sqlnet.ora
======
SQLNET.ALLOWED_LOGON_VERSION_SERVER=8
SQLNET.ALLOWED_LOGON_VERSION_CLIENT=8
======
重啟 listener
$ lsnrctl stop
$ lsnrctl start


2.版本不相容問題，要重新在19c Server那邊改密碼雜湊能相容舊版
ERROR:
ORA-01017: invalid username/password; logon denied

sqlplus / as sysdba
show pdbs
alter session set container=jamespdb1;
alter user hr identified by hr account unlock;


===DBLINK 建立方式 ================
注意: DBLINK不能透過 GRANT 方式建立，只能用 PUBLIC 或使用者本身私人建立
(ref: https://docs.oracle.com/cd/B19306_01/server.102/b14200/statements_5005.htm)

# 1- 10g client那邊tnsnames.ora新增
~~~
PLM13 =
  (DESCRIPTION =
    (ADDRESS = (PROTOCOL = TCP)(HOST = 192.168.56.19)(PORT = 1521))
    (CONNECT_DATA =
      (SERVER = DEDICATED)
      (SERVICE_NAME = jamespdb1)
    )
  )

~~~


# 2- 然後測試連接到 19c Server
sqlplus hr/hr@PLM13
exit

# 3- 接著10g那邊進入建立DB Link，然後測試 (注意: 私人連線只能私人連入建立,無法透過DBA授權或建schema方式)
$ sqlplus hr/hr

CREATE DATABASE LINK plm999 CONNECT TO hr IDENTIFIED BY hr USING 'PLM13';
select * from dual@plm999;



=======================================================
=== 補充: 
1. Oracle 19c後密碼雜湊與 10g不相容，查詢password_version看是否有相容 10G 
SELECT
    username,
    password_versions,
    expiry_date
FROM
    dba_users
WHERE
    username = 'HR';



2. 上述測試檢查都成功，DBLINK卻仍無法連接出現錯誤
注意如果用sqlplus 做10g連19c的DBLINK，如果還出現錯誤，可能因為密碼有大小之分，故密碼那邊補一下雙引號 (SQL Developer不需要)
ex: CREATE DATABASE LINK plm999 CONNECT TO hr IDENTIFIED BY "hr" USING 'PLM13';


或是再重新在19c改密碼，確認雜湊
ALTER USER hr IDENTIFIED BY hr;



3. 如果有額外設置 sqlnet.ora ，查看是否有在白名單內以及10g不支援新的演算法 AES256/SHA256 等
ex: 
----  19c
# 啟用加密與完整性檢查
SQLNET.ENCRYPTION_SERVER = required
SQLNET.ENCRYPTION_TYPES_SERVER = (AES256, AES192, AES128, 3DES168)

SQLNET.CRYPTO_CHECKSUM_SERVER = required
SQLNET.CRYPTO_CHECKSUM_TYPES_SERVER = (SHA256, SHA1)

# 允許舊版客戶端（10g）登入
SQLNET.ALLOWED_LOGON_VERSION_SERVER = 10

# 範例：若要限制來源 IP
TCP.VALIDNODE_CHECKING = YES
TCP.INVITED_NODES = (192.168.56.10, 192.168.56.11, jamesdb) # 也可以DNS解析的主機名稱


---- 10g (不需要設置,但這邊也補充一下安全的設置)
# 啟用加密與完整性檢查
SQLNET.ENCRYPTION_CLIENT = required
SQLNET.ENCRYPTION_TYPES_CLIENT = (AES128, 3DES168)

SQLNET.CRYPTO_CHECKSUM_CLIENT = required
SQLNET.CRYPTO_CHECKSUM_TYPES_CLIENT = (SHA1)

# 允許舊版登入（10g 自身）
SQLNET.ALLOWED_LOGON_VERSION_CLIENT = 10

